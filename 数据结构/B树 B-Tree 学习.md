### B 树

#### 1、B 树

> 平衡多路查找树（查找路径不只两个）

- 规则
  - 排序方式：所有节点关键字按递增次序排列，遵循左小右大原则
  - 子节点数：非叶节点的子节点数 > 1，且 <= M ，且 M >= 2，空树除外（M 阶代表一个树节点最多有多少个查找路径，M = 2 是 2 叉树，= 3 是 3 叉）
  - 关键字数：枝节点关键字数量 >= ceil(m/2)-1 个，且 <= M-1 个（ceil() 是朝正无穷方向取整的函数）
  - 所有叶节点均在同一层、叶节点除包含关键字和关键字记录的指针外，也有指向其子节点的指针，只不过指针地址都为 null，对应下图最后一层节点的空格子

![B树](图片\B树.jpg)

- 查找 E
  - 获取根节点关键字 M 进行比较，E < M，往找到指向左边的子节点（二分法左小右大）
  - 拿到关键字 D 和 G，D < E < G，所以直接找到 D 和 G 中间的节点
  - 拿到 E 和 F，直接返回关键字 E 和指针信息（如果树结构里没包含要查找的节点返回 null）

- 插入

  - 定义一个 5 阶树，关键字必须小于 5

  ![B树_插入1](图片\B树_插入1.jpg)

  ![B树_插入2](图片\B树_插入2.png)

![B树_插入3](图片\B树_插入3.png)

- 删除

  - 节点合并规则：要组成一个 5 路查找树，关键字数 < 2就要进行节点合并
  - 节点本身比左节点大，比右节点小
  - 关键字数小于二时先从子节点取，子节点没符合条件时向父节点取，取中间值往父节点放

  ![B树_删除](图片\B树_删除.png)

> B 树应用到数据库中时，充分利用磁盘块原理（磁盘数据存储采用块形式，每块大小 4K，每次 IO 进行数据读取时，同一磁盘块的数据可一次性读取），把节点大小限制和充分使用在磁盘快大小范围，树节点关键字增多后树层级比二叉树少，减少数据查找次数和复杂度

#### 2、B+树

- 规则
  - B+ 树父节点的元素都存在子节点中，是子节点最大或最小的元素
  - B+ 树非叶子节点不保存关键字记录指针，只进行数据索引，B+ 树每个非叶子节点能保存的关键字增加（磁盘页大小固定）
  - B+ 树叶子节点保存父节点所有关键字记录的指针，所有数据地址须到叶节点才能获取。每次数据查询次数一样
  - B+ 树叶节点关键字从小到大有序排列，左结尾数据会保存右节点开始数据的指针
- 非叶节点的子节点数 = 关键字数
  
- 特点
  - 单一节点存储更多元素，查询 IO 次数更少
  - 所有查询都要查找到叶子节点，查询性能稳定
  - 所有叶子节点形成有序链表，便于范围查询